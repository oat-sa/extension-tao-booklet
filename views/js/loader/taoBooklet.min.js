define("taoBooklet/controller/Booklet/editBooklet",["jquery","lodash","module","util/url"],function($,_,module,urlHelper){"use strict";return{start:function(){var $downloader=$("<iframe/>").hide();$("form").append($downloader),$(".btn-download").on("click",function(e){e.preventDefault();var $form=$(e.target).closest("form");$downloader.attr("src",urlHelper.route("download","Booklet","taoBooklet",{uri:$form.find('input[name="uri"]').val(),classUri:$form.find('input[name="classUri"]').val(),id:$form.find('input[name="id"]').val()}))})}}}),define("taoBooklet/controller/Booklet/preview",["jquery"],function($){"use strict";return{start:function(){var $frame=$(
".preview-test"),$container=$frame.closest(".content-container");$frame.css("min-height",$container.height()-50+"px")}}}),define("taoBooklet/controller/Booklet/wizard",["jquery"],function($){"use strict";return{start:function(){$(".main-container ").find("form")}}}),define("tpl!taoBooklet/tpl/print",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,buffer="";return buffer+='<main class="tao-scope ',buffer+=(0,this.escapeExpression)((helper=helpers.cls)?helper.call(depth0,{hash:{},data:data}
):"function"==typeof(helper=depth0&&depth0.cls)?helper.call(depth0,{hash:{},data:data}):helper)+'"></main>\n'})}),define("taoBooklet/controller/PrintTest/render",["jquery","lodash","core/logger","taoQtiPrint/runner/testRunner","tpl!taoBooklet/tpl/print"],function($,_,loggerFactory,testRunner,printTpl){"use strict";var logger=loggerFactory("printTest/render");function showMessage(msg,type){type=type||"info",$("body").append('<div class="feedback-'+type+'">'+msg+"</div>")}return{start:function(testData,options){var layoutOptions=options&&options.layout||{},layoutClasses={one_page_item:"one-item-per-page",one_page_section:"one-section-per-page"},
timeout=setTimeout(function(){showMessage("Something went wrong...","error"),ready()},45e3),$mainContainer=$(printTpl({cls:_.reduce(layoutOptions,function(list,value,name){return value&&layoutClasses[name]&&list.push(layoutClasses[name]),list},[]).join(" ")}));function ready(){window.status="DONE"}$("body").append($mainContainer),testRunner(testData,options).on("error",function(e){logger.error(e),showMessage(e,"error"),ready()}).on("ready",function(){var previous,pages,blankPage,computePageFromHeight;layoutOptions.add_blank_pages&&(pages=2,blankPage=function($section){$section.before('<div class="breaker"></div>'),pages++},computePageFromHeight=function(
height){6e3<height&&(pages+=Math.ceil(height/6e3)-1)},$mainContainer.children("section").each(function(){var height,$section=$(this);$section.hasClass("section")&&(pages%2==0&&blankPage($section),computePageFromHeight($section.outerHeight()),previous="section",pages++),$section.hasClass("item")&&("item"!==previous&&(pages%2!=0&&blankPage($section),height=$section.outerHeight(),$section.nextUntil(".section",".item").each(function(){height+=$(this).outerHeight()}),computePageFromHeight(height),pages++),previous="item")})),clearTimeout(timeout),ready()}).render($mainContainer)}}}),define("taoBooklet/component/taskQueue",["jquery","lodash","util/url",
"ui/taskQueue/table"],function($,_,urlHelper,taskQueueTableFactory){"use strict";var defaults={rows:10,dataUrl:urlHelper.route("getTasks","TaskQueueData","taoBooklet"),statusUrl:urlHelper.route("getStatus","TaskQueueData","taoBooklet"),removeUrl:urlHelper.route("archiveTask","TaskQueueData","taoBooklet")};return function(queueId,$container,config){var taskQueue=taskQueueTableFactory(_.merge({context:queueId},config||{},defaults));return taskQueue.init().render($container),taskQueue}}),define("taoBooklet/controller/Results/printWizard",["jquery","lodash","ui/hider","util/url","report","taoBooklet/component/taskQueue","jquery.fileDownload"],function($,_,hider,
urlHelper,report,taskQueueTableFactory){"use strict";return{start:function(){var $header=$("header.section-header"),$formContainer=$(".print-form"),$reportContainer=$(".print-report"),$form=$("form",$formContainer),$submitter=$(".form-submitter",$form),$sent=$(":input[name='"+$form.attr("name")+"_sent']",$form),asyncQueue=$header.data("async-queue"),$containers=$(".main-container");function switchContainer(purpose){hider.hide($containers),hider.show($containers.filter('[data-purpose="'+purpose+'"]'))}function refreshTree(){$(".tree").trigger("refresh.taotree",[{uri:$header.data("select-node")}])}function displayReport(response){switchContainer("report"),
$reportContainer.append(response),$submitter.removeAttr("disabled"),hider.toggle($("#fold",$reportContainer),response.nested),$('#fold > input[type="checkbox"]',$reportContainer).on("click",function(){report.fold()}),$("#import-continue",$reportContainer).on("click",refreshTree)}switchContainer("form"),$submitter.off("click").on("click",function(e){var params={},instances=[],classes=[];$submitter.attr("disabled",!0),e.preventDefault(),parseInt($sent.val(),10)&&(_.forEach($form.serializeArray(),function(param){0===param.name.indexOf("instances_")?instances.push(param.value):0===param.name.indexOf("classes_")?classes.push(param.value
):params[param.name]=param.value}),params.instances=encodeURIComponent(JSON.stringify(instances)),params.classes=encodeURIComponent(JSON.stringify(classes)),asyncQueue?$.ajax({url:$form.attr("action"),data:params,type:"POST",dataType:"text"}).done(displayReport):$.fileDownload($form.attr("action"),{httpMethod:"POST",data:params,failCallback:displayReport,successCallback:refreshTree}))}),asyncQueue&&taskQueueTableFactory($header.data("queue"),$containers.filter(".print-tasks"),{downloadUrl:urlHelper.route("downloadTask","TaskQueueData","taoBooklet")})}}}),define("taoBooklet/controller/routes",[],function(){"use strict";return{Booklet:{actions:{
editBooklet:"controller/Booklet/editBooklet",wizard:"controller/Booklet/wizard",preview:"controller/Booklet/preview"}},Results:{actions:{printWizard:"controller/Results/printWizard"}}}}),define("taoBooklet/loader/taoBooklet.bundle",function(){}),define("taoBooklet/loader/taoBooklet.min",["taoQtiPrint/loader/taoQtiPrint.min","taoItems/loader/taoItems.min","taoQtiItem/loader/taoQtiItem.min"],function(){});
//# sourceMappingURL=taoBooklet.min.js.map