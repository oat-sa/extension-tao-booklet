{"version":3,"mappings":"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","names":["loaderScript","configUrl","bundle","loadController","controllerOptions","controllerPath","params","window","controller","document","startController","bundles","require","define","$","_","__","module","urlHelper","taskQueue","treeTaskButtonFactory","actions","binder","start","taskRegenerateButton","$downloader","$regenerateBtn","replace","icon","label","render","data","uniqueValue","taskCreationUrl","taskCreationData","e","uri","classUri","id","config","previewAction","$frame","$container","actionManager","taskCreationButton","$oldSubmitter","$form","type","title","taskReportContainer","on","refreshTree","result","feedback","helpers","buffer","helper","stack1","previous","threshold","pages","blankPage","$section","computePageFromHeight","height","$include","href","hrefs","$newSection","testData","options","layoutOptions","layoutClasses","timeout","showMessage","ready","$mainContainer","cls","value","list","join","testRunner","logger","printLayoutHacking","extractSharedStimulus","clearTimeout","hider","$header","$formContainer","$reportContainer","$submitter","$containers","switchContainer","rows","dataUrl","statusUrl","removeUrl"],"sources":["../../loader/bootstrap.js","../controller/Booklet/editBooklet.js","../controller/Booklet/preview.js","../controller/Booklet/wizard.js","../tpl/print!tpl","../controller/PrintTest/render.js","../controller/Results/printWizard.js","../controller/routes.js","../component/taskQueue.js","module-create.js","/github/workspace/tao/views/build/config-wrap-end-default.js"],"sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016-2018 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * Bootstrap the app, start the entry controller\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\n(function(){\n    'use strict';\n\n\n\n    var loaderScript = document.getElementById('amd-loader');\n    var configUrl = loaderScript.getAttribute('data-config');\n    var bundle  = loaderScript.getAttribute('data-bundle');\n\n    var loadController = function loadController(){\n        var controllerOptions = {};\n        var controllerPath = loaderScript.getAttribute('data-controller');\n        var params = loaderScript.getAttribute('data-params');\n        try{\n            controllerOptions = JSON.parse(params);\n        } catch(err){\n            controllerOptions = {};\n        }\n        window.require([controllerPath], function(controller) {\n            var startController = function startController(){\n                if(!window.started){\n                    window.started = true;\n                    controller.start(controllerOptions);\n                }\n            };\n            document.addEventListener('readystatechange', startController, false);\n            if (document.readyState === 'complete') {\n                startController();\n            }\n        });\n    };\n\n    //always start to load the config\n    window.require([configUrl], function() {\n\n        //define the global loading mechanism\n        if(!window.loadBundles){\n            //keep tracl of loaded bundles, even if require does it,\n            //this prevent some unecessary cycles\n            window.loaded = {};\n\n            /**\n             * Loading entry point for inter bundle dependency,\n             * always take the bundles from the params and window.bundles\n             * @param {String[]} [bundles] - an optional list of bundle to load\n             */\n            window.loadBundles = function loadBundles(bundles){\n                bundles = bundles || [];\n                bundles = bundles.concat(window.bundles)\n                bundles = bundles.filter( function(item, index){\n                    return item && bundles.indexOf(item) === index && window.loaded[item] !== true;\n                });\n                require(bundles, function(){\n                    bundles.forEach( function( item ) {\n                        window.loaded[item] = true;\n                    });\n                    loadController();\n                });\n            }\n        }\n\n        if(bundle || (window.bundles && window.bundles.length)) {\n            window.loadBundles([bundle]);\n        } else {\n            loadController();\n        }\n    });\n})();\n\ndefine(\"loader/bootstrap\", function(){});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoBooklet/controller/Booklet/editBooklet',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'module',\n    'util/url',\n    'ui/taskQueue/taskQueue',\n    'ui/taskQueueButton/treeButton',\n    'layout/actions',\n    'layout/actions/binder'\n], function (\n    $,\n    _,\n    __,\n    module,\n    urlHelper,\n    taskQueue,\n    treeTaskButtonFactory,\n    actions,\n    binder\n) {\n    'use strict';\n\n    return {\n        start() {\n\n            var $downloader = $('<iframe/>').hide();\n            var $regenerateBtn = $('#booklet-regenerate');\n            var taskRegenerateButton;\n\n            $regenerateBtn.show();\n\n            taskRegenerateButton = treeTaskButtonFactory({\n                replace : true,\n                icon : 'reset',\n                label : __('Regenerate'),\n                taskQueue : taskQueue\n            }).render($regenerateBtn);\n\n            binder.register('booklet_regenerate', function register(actionContext) {\n                var data = _.pick(actionContext, ['uri', 'classUri', 'id']);\n                var uniqueValue = data.uri || data.classUri || '';\n                taskRegenerateButton.setTaskConfig({\n                    taskCreationUrl : this.url,\n                    taskCreationData : {uri : uniqueValue}\n                }).start();\n            });\n\n            $('form').append($downloader);\n\n            $('.btn-download').on('click', function (e) {\n                e.preventDefault();\n                var $form = $(e.target).closest('form');\n\n                $downloader.attr('src', urlHelper.route('download', 'Booklet', 'taoBooklet', {\n                    uri: $form.find('input[name=\"uri\"]').val(),\n                    classUri: $form.find('input[name=\"classUri\"]').val(),\n                    id: $form.find('input[name=\"id\"]').val()\n                }));\n            });\n\n            const config = module.config();\n            const previewAction = actions.getBy('booklet-preview');\n            if (previewAction) {\n                previewAction.state.disabled = !config.isPreviewEnabled;\n                actions.updateState();\n            }\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoBooklet/controller/Booklet/preview',['jquery'], function ($) {\n    'use strict';\n\n    return {\n        start: function () {\n\n            //resize the frame to it's container height\n            var $frame = $('.preview-test');\n            var $container  = $frame.closest('.content-container');\n            $frame.css('min-height', ($container.height() - 50) + 'px' );\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoBooklet/controller/Booklet/wizard',[\n    'lodash',\n    'jquery',\n    'i18n',\n    'ui/filter',\n    'ui/feedback',\n    'util/url',\n    'layout/actions',\n    'core/promise',\n    'ui/taskQueue/taskQueue',\n    'ui/taskQueueButton/standardButton'\n], function (_, $, __, filterFactory, feedback, urlUtils, actionManager, Promise, taskQueue, taskCreationButtonFactory) {\n    'use strict';\n\n    /**\n     * wrapped the old jstree API used to refresh the tree and optionally select a resource\n     * @param {String} [uriResource] - the uri resource node to be selected\n     */\n    var refreshTree = function refreshTree(uriResource){\n        actionManager.trigger('refresh', {\n            uri : uriResource\n        });\n    };\n\n    return {\n        start: function () {\n            var $form = $('#form_1');\n            var $container = $form.closest('.content-block');\n            var taskCreationButton, $oldSubmitter;\n            var $regenerateBtn = $('#booklet-regenerate');\n\n            // hide regenerate on the create page\n            $regenerateBtn.hide();\n\n            //find the old submitter and replace it with the new component\n            $oldSubmitter = $form.find('.form-submitter');\n            taskCreationButton = taskCreationButtonFactory({\n                type : 'info',\n                icon : 'play',\n                title : __('Generate booklet'),\n                label : __('Generate'),\n                taskQueue : taskQueue,\n                taskCreationUrl : $form.prop('action'),\n                taskCreationData : function getTaskCreationData(){\n                    return $form.serializeArray();\n                },\n                taskReportContainer : $container\n            })\n            .on('enqueued', function () {\n                refreshTree();\n            })\n            .on('finished', function(result){\n                if (result.task\n                    && result.task.report\n                    && _.isArray(result.task.report.children)\n                    && result.task.report.children.length\n                    && result.task.report.children[0]) {\n\n                        if(result.task.report.children[0].data\n                            && result.task.report.children[0].data.uriResource){\n                            feedback().info(__('%s completed', result.task.taskLabel));\n                            refreshTree(result.task.report.children[0].data.uriResource);\n                        }else{\n                            refreshTree();\n                        }\n                } else {\n                    // move from the wizard on generated\n                    refreshTree();\n                }\n            }).on('continue', function(){\n                refreshTree();\n            }).on('error', function(err){\n                //format and display error message to user\n                feedback().error(err.errorMessage);\n                // refreshTree();\n                $('#booklet-new a').click();\n            }).render($oldSubmitter.closest('.form-toolbar'));\n\n            //replace the old submitter with the new one and apply its style\n            $oldSubmitter.replaceWith(taskCreationButton.getElement().css({float: 'right'}));\n        }\n    };\n});\n\n","\ndefine('tpl!taoBooklet/tpl/print', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<main class=\\\"tao-scope \";\n  if (helper = helpers.cls) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.cls); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></main>\";\n  return buffer;\n  });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015-2017 (original work) Open Assessment Technologies SA;\n */\n\n/**\n *\n * This controller renders a printable test in the current page.\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoBooklet/controller/PrintTest/render',[\n    'jquery',\n    'lodash',\n    'core/logger',\n    'taoQtiPrint/runner/testRunner',\n    'tpl!taoBooklet/tpl/print'\n], function ($, _, loggerFactory, testRunner, printTpl) {\n    'use strict';\n\n    var logger = loggerFactory('printTest/render');\n\n    /**\n     * Old school way to debug document, especially when generated in PDF.\n     * It appends the message to the body.\n     * @param {String} msg - the content to display\n     * @param {String} type - the type of message\n     */\n    function showMessage(msg, type) {\n        type = type || 'info';\n        $('body').append(`<div class=\"feedback-${type}\">${msg}</div>`);\n    }\n\n    /**\n     * Hack the current layout to match arbitrary rules\n     * @param {JQuery} $container\n     */\n    function printLayoutHacking($container) {\n\n        var threshold = 6000;   //this height seems to work - value is empirical and linked to the A4 page layout with 300 DPI\n        var pages = 2;          //start on page 2\n        var previous;           //keep a ref to the previous section\n\n        //add a blank page\n        var blankPage = function blankPage($section) {\n            $section.before('<div class=\"breaker\"></div>');\n            pages++;\n        };\n\n        //add pages based on the given height\n        var computePageFromHeight = function computePageFromHeight(height) {\n            if (height > threshold) {\n                pages += Math.ceil(height / threshold) - 1;\n            }\n        };\n\n        //browse direct section add apply the odd/even rules for section and items\n        $container.children('section').each(function () {\n            var $section = $(this);\n            var height;\n\n            if ($section.hasClass('section')) {\n\n                if (pages % 2 === 0) {\n                    blankPage($section);\n                }\n\n                computePageFromHeight($section.outerHeight());\n\n                previous = 'section';\n                pages++;\n            }\n            if ($section.hasClass('item')) {\n                if (previous !== 'item') {\n\n                    if (pages % 2 !== 0) {\n                        blankPage($section);\n                    }\n\n                    height = $section.outerHeight();\n                    $section.nextUntil('.section', '.item').each(function () {\n                        height += $(this).outerHeight();\n                    });\n                    computePageFromHeight(height);\n\n                    pages++;\n                }\n                previous = 'item';\n            }\n        });\n    }\n\n    /**\n     * Extract shared stimulus from a item, put it in section before a item\n     * Remove repeated shared stimulus\n     * @param {JQuery} $container\n     */\n    function extractSharedStimulus($container) {\n        const hrefs = {};\n        // find shared stimulus\n        $container.find('.qti-include').each(function () {\n            const $include = $(this);\n            const href = $include.attr('data-href');\n            if (!hrefs[href]) {\n                hrefs[href] = true;\n                const $section = $include.closest('section.item');\n                // move shared stimulus in section before item\n                const $newSection = $('<section class=\"grid-row include\"></section>');\n                $newSection.append($include);\n                $section.before($newSection);\n            } else {\n                // each shared stimulus is included only once\n                $include.remove();\n            }\n        });\n    }\n\n    /**\n     * The renderer controller\n     * @exports taoBooklet/controller/printTest/render\n     */\n    return {\n\n        /**\n         * Controller entry point\n         * @param {Object} config\n         */\n        start: function start(config) {\n            var testData = config.testData;\n            var options = config.options;\n            var layoutOptions = options && options.layout || {};\n            var layoutClasses = {\n                'one_page_item': 'one-item-per-page',\n                'one_page_section': 'one-section-per-page'\n            };\n\n            //this is just in case something went wrong, but we weren't able to catch it.\n            var timeout = setTimeout(function () {\n                showMessage(\"Something went wrong...\", 'error');\n                ready();\n            }, 45 * 1000);\n\n            //the content will be inserted in a detached element (to save time)\n            var $mainContainer = $(printTpl({\n                cls: _.reduce(layoutOptions, function (list, value, name) {\n                    if (value && layoutClasses[name]) {\n                        list.push(layoutClasses[name]);\n                    }\n                    return list;\n                }, []).join(' ')\n            }));\n\n            /**\n             * As the page can be called by an external tool and\n             * as we build the page in JS asynchronously, we need this hack\n             * to tell the 3rd part tool that the page is ready.\n             */\n            function ready() {\n                window.status = 'DONE';\n            }\n\n            //we attach the container to the DOM\n            $('body').append($mainContainer);\n\n            //instantiate the TestRunner\n            testRunner(testData, options)\n                .on('error', function (e) {\n                    logger.error(e);\n                    showMessage(e, 'error');\n                    ready();\n                })\n                .on('ready', function () {\n\n                    //hack layout calculation\n                    if (layoutOptions['add_blank_pages']) {\n                        printLayoutHacking($mainContainer);\n                    }\n\n                    extractSharedStimulus($mainContainer);\n\n                    clearTimeout(timeout);\n\n                    //we are done\n                    ready();\n                })\n                .render($mainContainer);\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoBooklet/controller/Results/printWizard',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/hider',\n    'util/url',\n    'ui/feedback',\n    'layout/actions/binder',\n    'ui/taskQueue/taskQueue',\n    'ui/taskQueueButton/standardButton'\n], function ($, _, __, hider, urlHelper, feedback, binder, taskQueue, taskCreationButtonFactory) {\n    'use strict';\n\n    return {\n        start: function () {\n            var $header = $('header.section-header');\n            var $formContainer = $('.print-form');\n            var $reportContainer = $('.print-report');\n            var $form = $('form', $formContainer);\n            var $submitter = $('.form-submitter', $form);\n            var $containers = $('.main-container');\n            var taskCreationButton;\n\n            function switchContainer(purpose) {\n                hider.hide($containers);\n                hider.show($containers.filter('[data-purpose=\"' + purpose + '\"]'));\n            }\n\n            function refreshTree() {\n                $('.tree').trigger('refresh.taotree', [{\n                    uri : $header.data('select-node')\n                }]);\n            }\n\n            switchContainer('form');\n            taskCreationButton = taskCreationButtonFactory({\n                type : 'info',\n                icon : 'play',\n                title : __('Generate Results'),\n                label : __('Generate'),\n                taskQueue : taskQueue,\n                taskCreationUrl : $form.prop('action'),\n                taskCreationData : function getTaskCreationData(){\n                    return $form.serializeArray();\n                },\n                taskReportContainer : $reportContainer\n            }).on('finished', function(result){\n                if (result.task\n                    && result.task.report\n                    && _.isArray(result.task.report.children)\n                    && result.task.report.children.length\n                    && result.task.report.children[0]) {\n                    if(result.task.report.children[0].data\n                        && result.task.report.children[0].data.uriResource){\n                        feedback().info(__('%s completed', result.task.taskLabel));\n                        refreshTree(result.task.report.children[0].data.uriResource);\n                    }else{\n                        this.displayReport(result.task.report.children[0], __('Error'));\n                        switchContainer('report');\n                    }\n                }\n            }).on('continue', function(){\n                refreshTree();\n            }).on('error', function(err){\n                //format and display error message to user\n                // feedback().error(err);\n                taskCreationButton.terminate().reset();\n                this.displayReport(err, __('Error'));\n                switchContainer('report');\n            }).on('enqueued', function(){\n                refreshTree();\n            }).render($submitter.closest('.form-toolbar'));\n\n            //replace the old submitter with the new one and apply its style\n            $submitter.replaceWith(taskCreationButton.getElement().css({float: 'right'}));\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoBooklet/controller/routes',[],function () {\n    'use strict';\n\n    return {\n        'Booklet': {\n            'actions': {\n                'editBooklet' : 'controller/Booklet/editBooklet',\n                'wizard'      : 'controller/Booklet/wizard',\n                'preview'     : 'controller/Booklet/preview'\n            }\n        },\n        'Results': {\n            'actions': {\n                'printWizard' : 'controller/Results/printWizard'\n            }\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-SÃ©bastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoBooklet/component/taskQueue',[\n    'jquery',\n    'lodash',\n    'util/url',\n    'ui/taskQueue/table'\n], function ($, _, urlHelper, taskQueueTableFactory) {\n    'use strict';\n\n    var defaults = {\n        rows: 10,\n        dataUrl: urlHelper.route('getTasks', 'TaskQueueData', 'taoBooklet'),\n        statusUrl: urlHelper.route('getStatus', 'TaskQueueData', 'taoBooklet'),\n        removeUrl: urlHelper.route('archiveTask', 'TaskQueueData', 'taoBooklet')\n    };\n\n    /**\n     * Renders a booklet task queue table component\n     * @param {String} queueId\n     * @param {jQuery} $container\n     * @param {Object} [config]\n     * @returns {taskQueueTable}\n     */\n    function bookletTaskQueue(queueId, $container, config) {\n        var taskQueue = taskQueueTableFactory(_.merge({context: queueId}, config || {}, defaults));\n\n        taskQueue.init()\n            .render($container);\n\n        return taskQueue;\n    }\n\n    return bookletTaskQueue;\n});\n\n","\ndefine(\"taoBooklet/loader/taoBooklet.bundle\", function(){});\n","window.bundles = (window.bundles || []).concat([\"taoQtiPrint/loader/taoQtiPrint.min\",\"taoItems/loader/taoItems.min\",\"taoQtiItem/loader/taoQtiItem.min\"]);\n"]}